---
import { getCollection, render } from "astro:content"
import { Separator } from "@/components/ui/separator"
import Layout from "../layouts/Layout.astro"
import AwardSection from "./_sections/award-section.astro"
import CertificateSection from "./_sections/certificate-section.astro"
import ExperienceSection from "./_sections/experience-section.astro"
import HeroSection from "./_sections/hero-section.astro"
import ProjectSection from "./_sections/project-section.astro"

const basics = await getCollection("basics")
const profile = basics[0]?.data

const work = await getCollection("work")
const projects = await getCollection("projects")

const certificates = await getCollection("certificates")
const awards = await getCollection("awards")

// Sort by date (descending)
const sortedWork = work.sort((a, b) => b.data.dateStart.valueOf() - a.data.dateStart.valueOf())

const sortedAwards = awards.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
const sortedProjects = projects.sort((a, b) => a.data.priority - b.data.priority)

const workWithContent = await Promise.all(
  sortedWork.map(async (entry) => {
    const { Content } = await render(entry)
    return { ...entry, Content }
  })
)

const awardsWithContent = await Promise.all(
  sortedAwards.map(async (entry) => {
    const { Content } = await render(entry)
    return { ...entry, Content }
  })
)

const projectsWithContent = await Promise.all(
  sortedProjects.map(async (entry) => {
    const { Content } = await render(entry)
    return { ...entry, Content }
  })
)
---

<Layout title={`${profile?.name} | AI와 함께하는 개발자 이력서`}>
  <main
    class="container max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8 min-h-screen"
  >
    <HeroSection profile={profile} />

    <Separator className="my-12" />

    <ExperienceSection experiences={workWithContent} />

    <Separator className="my-12" />

    <ProjectSection projects={projectsWithContent} />

    <Separator className="my-12" />

    <CertificateSection certificates={certificates} />

    <Separator className="my-12" />

    <AwardSection awards={awardsWithContent} />
  </main>
</Layout>
