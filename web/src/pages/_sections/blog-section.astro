---
import { OBSIDIAN_BLOG_SECTION_URL } from "@/lib/blog/obsidian-publish"
import { curateTechnicalWritingPosts } from "@/lib/blog/technical-writing-curation"

interface BlogPostItem {
  title: string
  url: string
  publishedAt: string
  summary?: string
}

const { posts = [] } = Astro.props as { posts?: BlogPostItem[] }
const { featuredPost, latestPosts } = curateTechnicalWritingPosts(posts)

function formatDate(iso: string): string {
  const date = new Date(iso)
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  })
}
---

<section id="blog" class="mb-12">
  <h2 class="text-2xl font-bold text-resume-text-main mb-2 tracking-tight">Technical Writing</h2>
  <p class="text-sm text-resume-text-muted mb-8 leading-relaxed">
    설계 의사결정과 구조적 사고를 보여주는 글을 대표 1개와 최신 4개로 큐레이션했습니다.
  </p>

  {
    posts.length > 0 ? (
      <div class="space-y-4">
        {featuredPost && (
          <article class="group bg-resume-card-bg rounded-sm border border-resume-primary/40 p-5 transition-all duration-300 hover:border-resume-primary/60 hover:bg-resume-highlight/30">
            <div class="mb-2">
              <span class="inline-flex items-center rounded-full border border-resume-primary/40 px-2.5 py-1 text-xs font-semibold tracking-wide text-resume-primary">
                Representative Writing
              </span>
            </div>
            <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
              <a
                href={featuredPost.url}
                target="_blank"
                rel="noopener noreferrer"
                class="text-base font-semibold text-resume-text-heading group-hover:text-resume-primary transition-colors underline-offset-4 hover:underline focus-visible:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-resume-bg rounded-sm"
                data-ga-event="blog_post_click"
                data-ga-post={featuredPost.title}
                data-ga-source="obsidian"
                data-ga-slot="featured"
              >
                {featuredPost.title}
              </a>
              <span class="text-sm text-resume-text-muted font-mono whitespace-nowrap">
                {formatDate(featuredPost.publishedAt)}
              </span>
            </div>

            {featuredPost.summary && (
              <p class="mt-3 text-sm text-resume-text-muted leading-relaxed">{featuredPost.summary}</p>
            )}
          </article>
        )}

        {latestPosts.length > 0 && (
          <>
            <h3 class="text-sm font-semibold uppercase tracking-wider text-resume-text-muted pt-2">
              Latest Writing
            </h3>
            {latestPosts.map((post) => (
              <article class="group bg-resume-card-bg rounded-sm border border-resume-border p-5 transition-all duration-300 hover:border-resume-primary/50 hover:bg-resume-highlight/30">
                <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <a
                    href={post.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-base font-semibold text-resume-text-heading group-hover:text-resume-primary transition-colors underline-offset-4 hover:underline focus-visible:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-resume-bg rounded-sm"
                    data-ga-event="blog_post_click"
                    data-ga-post={post.title}
                    data-ga-source="obsidian"
                    data-ga-slot="latest"
                  >
                    {post.title}
                  </a>
                  <span class="text-sm text-resume-text-muted font-mono whitespace-nowrap">
                    {formatDate(post.publishedAt)}
                  </span>
                </div>

                {post.summary && (
                  <p class="mt-3 text-sm text-resume-text-muted leading-relaxed">{post.summary}</p>
                )}
              </article>
            ))}
          </>
        )}
      </div>
    ) : (
      <p class="text-resume-text-muted">Technical Writing 글을 불러오지 못했습니다.</p>
    )
  }

  <div class="mt-6">
    <a
      href={OBSIDIAN_BLOG_SECTION_URL}
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center text-sm font-medium text-resume-primary hover:text-resume-secondary focus-visible:text-resume-secondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-resume-bg rounded-sm transition-colors"
      data-ga-event="blog_all_posts_click"
      data-ga-source="obsidian"
    >
      View all posts
    </a>
  </div>
</section>
