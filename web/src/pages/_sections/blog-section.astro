---
import { OBSIDIAN_BLOG_SECTION_URL } from "@/lib/blog/obsidian-publish"

interface BlogPostItem {
  title: string
  url: string
  publishedAt: string
  summary?: string
}

const { posts = [] } = Astro.props as { posts?: BlogPostItem[] }

function formatDate(iso: string): string {
  const date = new Date(iso)
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  })
}
---

<section id="blog" class="mb-12">
  <h2 class="text-2xl font-bold text-resume-text-main mb-8 tracking-tight">Blog</h2>

  {
    posts.length > 0 ? (
      <div class="space-y-4">
        {posts.map((post) => (
          <article class="group bg-resume-card-bg rounded-sm border border-resume-border p-5 transition-all duration-300 hover:border-resume-primary/50 hover:bg-resume-highlight/30">
            <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
              <a
                href={post.url}
                target="_blank"
                rel="noopener noreferrer"
                class="text-base font-semibold text-resume-text-heading group-hover:text-resume-primary transition-colors underline-offset-4 hover:underline focus-visible:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-resume-bg rounded-sm"
                data-ga-event="blog_post_click"
                data-ga-post={post.title}
                data-ga-source="obsidian"
              >
                {post.title}
              </a>
              <span class="text-sm text-resume-text-muted font-mono whitespace-nowrap">
                {formatDate(post.publishedAt)}
              </span>
            </div>

            {post.summary && <p class="mt-3 text-sm text-resume-text-muted leading-relaxed">{post.summary}</p>}
          </article>
        ))}
      </div>
    ) : (
      <p class="text-resume-text-muted">최근 블로그 글을 불러오지 못했습니다.</p>
    )
  }

  <div class="mt-6">
    <a
      href={OBSIDIAN_BLOG_SECTION_URL}
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center text-sm font-medium text-resume-primary hover:text-resume-secondary focus-visible:text-resume-secondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-resume-bg rounded-sm transition-colors"
      data-ga-event="blog_all_posts_click"
      data-ga-source="obsidian"
    >
      View all posts
    </a>
  </div>
</section>
