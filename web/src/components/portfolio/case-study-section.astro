---
import type { CollectionEntry } from "astro:content"
import ImpactBadgeCards from "@/components/portfolio/impact-badge-cards.astro"
import StoryThreadTimeline from "@/components/portfolio/story-thread-timeline.astro"
import { Badge } from "@/components/ui/badge"
import { Separator } from "@/components/ui/separator"
import type { PortfolioCaseContract } from "@/lib/resume-portfolio/contracts"

interface Props {
  portfolioCase: PortfolioCaseContract
  project: CollectionEntry<"projects">
}

const { portfolioCase, project } = Astro.props
const storyThread = project.data.storyThread

if (!storyThread) {
  throw new Error(`storyThread is required for caseId: ${portfolioCase.caseId}`)
}
---

<article class="mb-24 scroll-mt-24 group/case relative space-y-16">
  <section id="hook" class="scroll-mt-24 space-y-8 print:break-inside-avoid">
    <div class="space-y-5">
      <p class="text-sm font-semibold uppercase tracking-[0.2em] text-resume-primary">
        Case Study
      </p>
      <h1 class="text-3xl sm:text-4xl font-extrabold text-resume-text-heading tracking-tight leading-tight">
        {portfolioCase.title}
      </h1>
      <p class="text-lg leading-relaxed text-resume-text-main/85">
        {project.data.description}
      </p>
    </div>

    {project.data.techStack && project.data.techStack.length > 0 && (
      <div class="flex flex-wrap gap-2">
        {project.data.techStack.map((tech) => (
          <Badge
            variant="outline"
            className="text-sm font-normal bg-resume-card-bg text-resume-text-main border-resume-border"
          >
            {tech}
          </Badge>
        ))}
      </div>
    )}

    <ImpactBadgeCards impacts={storyThread.impacts} />
  </section>

  <section id="context" class="scroll-mt-24 space-y-4 print:break-inside-avoid">
    <h2 class="text-2xl font-bold text-resume-text-heading tracking-tight">Context</h2>
    <p class="text-base leading-relaxed text-resume-text-main/90">
      {storyThread.context}
    </p>
  </section>

  <section id="threads" class="scroll-mt-24 space-y-6 print:break-inside-avoid">
    <h2 class="text-2xl font-bold text-resume-text-heading tracking-tight">Story Threads</h2>
    <StoryThreadTimeline threads={storyThread.threads} />
  </section>

  <section id="retrospective" class="scroll-mt-24 space-y-4 print:break-inside-avoid">
    <h2 class="text-2xl font-bold text-resume-text-heading tracking-tight">Retrospective</h2>
    <p class="text-base leading-relaxed text-resume-text-main/90">
      {storyThread.lessonsLearned}
    </p>
  </section>

  <Separator className="mt-10 print:hidden" />
</article>
