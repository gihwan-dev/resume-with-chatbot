---
import CompareToggle from "@/components/portfolio/compare-toggle.astro"
import type { StoryThreadItem } from "@/lib/resume-portfolio/contracts"

interface Props {
  threads: StoryThreadItem[]
}

const { threads } = Astro.props
---

<ol class="space-y-10 sm:space-y-12 lg:space-y-14" data-thread-list>
  {threads.map((thread, index) => (
    <li
      class="relative min-w-0 pl-9 sm:pl-10 lg:pl-12 print:break-inside-avoid"
      data-thread-item
      data-thread-index={index}
    >
      <span
        class="absolute left-2.5 top-5 bottom-0 w-px bg-resume-border/80 sm:left-3 print:bg-slate-400"
        data-thread-line
        aria-hidden="true"
      />
      <span class="absolute left-0 top-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full border border-resume-primary/40 bg-resume-bg text-[10px] font-bold text-resume-primary sm:top-1 sm:h-6 sm:w-6 sm:text-xs print:border-slate-500 print:bg-white print:text-slate-700" data-thread-marker>
        {index + 1}
      </span>

      <div class="min-w-0 space-y-4 pb-2 sm:space-y-5">
        <h3
          class="break-words text-lg font-bold leading-tight text-resume-text-heading sm:text-xl print:text-slate-900"
          data-thread-title
        >
          {thread.issueTitle}
        </h3>

        <section class="space-y-2" data-thread-problem-section>
          <h4 class="text-xs font-bold uppercase tracking-wide text-rose-700 dark:text-rose-300 sm:text-sm print:text-rose-700">
            Problem
          </h4>
          <ul
            class="space-y-2 break-words pl-5 text-sm leading-relaxed text-resume-text-main/85 marker:text-rose-500 print:text-slate-800"
            data-thread-problem-list
          >
            {thread.problems.map((problem) => (
              <li>{problem}</li>
            ))}
          </ul>
        </section>

        <blockquote
          class="break-words border-l-4 border-resume-primary/40 bg-resume-highlight/70 px-3 py-3 text-sm leading-relaxed italic text-resume-text-heading/90 sm:px-4 print:border-slate-400 print:bg-slate-100/40 print:text-slate-800"
          data-thread-thought-process
        >
          {thread.thoughtProcess}
        </blockquote>

        <section class="space-y-2" data-thread-action-section>
          <h4 class="text-xs font-bold uppercase tracking-wide text-sky-700 dark:text-sky-300 sm:text-sm print:text-sky-700">
            Action
          </h4>
          <ul
            class="space-y-2 break-words pl-5 text-sm leading-relaxed text-resume-text-main/85 marker:text-sky-500 print:text-slate-800"
            data-thread-action-list
          >
            {thread.actions.map((action) => (
              <li>{action}</li>
            ))}
          </ul>

          {thread.comparison && (
            <CompareToggle
              beforeLabel={thread.comparison.beforeLabel}
              afterLabel={thread.comparison.afterLabel}
            >
              <div slot="before">
                <ul class="space-y-2 pl-5 text-sm leading-relaxed text-resume-text-main/80 marker:text-rose-500">
                  {thread.comparison.before.map((item) => (
                    <li>{item}</li>
                  ))}
                </ul>
              </div>
              <div slot="after">
                <ul class="space-y-2 pl-5 text-sm leading-relaxed text-resume-text-main/90 marker:text-emerald-500">
                  {thread.comparison.after.map((item) => (
                    <li>{item}</li>
                  ))}
                </ul>
              </div>
            </CompareToggle>
          )}
        </section>

        <section class="space-y-2" data-thread-result-section>
          <h4 class="text-xs font-bold uppercase tracking-wide text-emerald-700 dark:text-emerald-300 sm:text-sm print:text-emerald-700">
            Result
          </h4>
          <p
            class="break-words text-sm leading-relaxed text-resume-text-main/90 print:text-slate-800"
            data-thread-result-text
          >
            {thread.result}
          </p>
        </section>
      </div>
    </li>
  ))}
</ol>
